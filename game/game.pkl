module game
import ".../engine/data.pkl" as Data
import ".../engine/map.pkl" as ZSMap
import ".../engine/faction/faction.pkl" as Faction
import ".../engine/faction/main.pkl" as MainFaction
import ".../engine/faction/merc.pkl" as MercFaction
// import ".../factions/non_player.pkl" as NonPlayerFaction

maps: Listing<ZSMap> = import("maps/maps.pkl").maps
factions: Listing<MainFaction> = import("factions/factions.pkl").factions
mercenaries: Listing<MercFaction> = import("mercs/mercs.pkl").mercs
// nonplayer: Listing<NonPlayerFaction> = import("non_players/non_players.pkl").non_players
local find_kids = (x) -> x.recursive_children
local get_kids = (x) -> x.toList().flatMap(find_kids)
local everything = List(maps, factions, mercenaries).flatMap(get_kids)

all: Mapping<String, Data> = everything.toMap((x) -> x.id, (x) -> x).toMapping()

